<div class="space-y-8">
  <!-- Page Header -->
  <div>
    <h1 class="text-3xl font-bold text-gray-800">Recettes sans Titre</h1>
    <p class="mt-1 text-gray-500">
      Consignez les recettes perçues sans ordre, puis régularisez-les.
    </p>
  </div>

  <!-- Tab Navigation -->
  <div class="border-b border-gray-200">
    <nav class="-mb-px flex gap-6" aria-label="Tabs">
      <button
        (click)="selectTab('consignation')"
        [ngClass]="{
          'border-[#187181] text-[#187181] font-semibold':
            activeTab === 'consignation',
          'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300':
            activeTab !== 'consignation'
        }"
        class="px-1 py-4 text-sm font-medium border-b-2"
      >
        1. Consigner une Recette
      </button>
      <button
        (click)="selectTab('regularisation')"
        [ngClass]="{
          'border-[#187181] text-[#187181] font-semibold':
            activeTab === 'regularisation',
          'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300':
            activeTab !== 'regularisation'
        }"
        class="px-1 py-4 text-sm font-medium border-b-2"
      >
        2. Régulariser les Recettes en Attente
      </button>
    </nav>
  </div>

  <!-- Tab Content -->
  <div>
    <!-- Tab 1: Formulaire de Consignation -->
    <div *ngIf="activeTab === 'consignation'" class="max-w-2xl mx-auto">
      <form
        [formGroup]="consignationForm"
        (ngSubmit)="submitConsignation()"
        class="p-8 space-y-6 bg-white rounded-lg shadow-sm"
      >
        <h2 class="text-xl font-semibold text-gray-800">
          Détails de la recette à consigner
        </h2>
        <div>
          <label for="montant" class="block text-sm font-medium text-gray-700"
            >Montant (DZD)</label
          >
          <input
            type="number"
            id="montant"
            formControlName="montant"
            class="w-full px-3 py-2 mt-1 text-gray-800 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#187181]"
          />
        </div>
        <div>
          <label
            for="provenance"
            class="block text-sm font-medium text-gray-700"
            >Provenance</label
          >
          <select
            id="provenance"
            formControlName="provenance"
            class="w-full px-3 py-2 mt-1 text-gray-800 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#187181]"
          >
            <option value="" disabled>Sélectionner...</option>
            <option value="Justice">Justice</option>
            <option value="Douane">Douane</option>
            <option value="Domaine">Domaine</option>
            <option value="Autre">Autre</option>
          </select>
        </div>
        <div>
          <label for="motif" class="block text-sm font-medium text-gray-700"
            >Motif de la recette</label
          >
          <textarea
            id="motif"
            formControlName="motif"
            rows="3"
            placeholder="Ex: Amende transactionnelle, vente aux enchères..."
            class="w-full px-3 py-2 mt-1 text-gray-800 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#187181]"
          ></textarea>
        </div>
        <div>
          <label
            for="dateConsignation"
            class="block text-sm font-medium text-gray-700"
            >Date de Consignation</label
          >
          <input
            type="date"
            id="dateConsignation"
            formControlName="dateConsignation"
            class="w-full px-3 py-2 mt-1 text-gray-800 bg-gray-50 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#187181]"
          />
        </div>
        <div class="pt-4 border-t border-gray-200">
          <button
            type="submit"
            [disabled]="consignationForm.invalid"
            class="w-full flex justify-center px-6 py-3 font-semibold text-white bg-[#187181] rounded-lg hover:opacity-90 disabled:opacity-50"
          >
            Consigner et Passer à la Régularisation
          </button>
        </div>
      </form>
    </div>

    <!-- Tab 2: Liste pour Régularisation -->
    <div *ngIf="activeTab === 'regularisation'">
      <div class="overflow-x-auto bg-white rounded-lg shadow-sm">
        <table class="w-full text-sm text-left text-gray-500">
          <thead class="text-xs text-gray-700 uppercase bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3">Date Consignation</th>
              <th scope="col" class="px-6 py-3">Provenance</th>
              <th scope="col" class="px-6 py-3">Motif</th>
              <th scope="col" class="px-6 py-3 text-right">Montant (DZD)</th>
              <th scope="col" class="px-6 py-3 text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let c of consignationsEnAttente"
              class="bg-white border-b border-gray-200 hover:bg-gray-50"
            >
              <td class="px-6 py-4">
                {{ c.dateConsignation | date : "dd/MM/yyyy" }}
              </td>
              <td class="px-6 py-4">{{ c.provenance }}</td>
              <td class="px-6 py-4">{{ c.motif }}</td>
              <td class="px-6 py-4 text-right font-mono font-bold">
                {{ c.montant | currency : "DZD " : "symbol" : "1.2-2" }}
              </td>
              <td class="px-6 py-4 text-center">
                <button
                  (click)="openRegularisationModal(c)"
                  class="px-3 py-1 text-sm font-semibold text-white bg-green-600 rounded-lg hover:bg-green-700"
                >
                  Régulariser
                </button>
              </td>
            </tr>
            <tr *ngIf="consignationsEnAttente.length === 0">
              <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                Aucune recette en attente de régularisation.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal Dialog for Regularisation -->
<div
  *ngIf="isModalOpen && selectedConsignation"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 transition-opacity"
>
  <div
    class="relative w-full max-w-lg p-8 bg-white rounded-lg shadow-xl"
    (click)="$event.stopPropagation()"
  >
    <!-- Modal Header -->
    <div class="flex items-start justify-between pb-4 border-b border-gray-200">
      <div>
        <h3 class="text-xl font-semibold text-gray-900">
          Régulariser une Recette
        </h3>
        <p class="text-sm text-gray-500">
          Lier la recette consignée à un ordre de recette.
        </p>
      </div>
      <button
        (click)="closeModal()"
        class="p-1 text-gray-400 rounded-full hover:bg-gray-200 hover:text-gray-600"
      >
        ×
      </button>
    </div>
    <!-- Modal Body -->
    <form
      [formGroup]="regularisationForm"
      (ngSubmit)="submitRegularisation()"
      class="mt-6 space-y-4"
    >
      <div class="p-4 bg-gray-50 rounded-lg">
        <p class="text-sm text-gray-600">
          Vous régularisez la recette de
          <span class="font-bold">{{
            selectedConsignation.montant | currency : "DZD"
          }}</span>
          du
          <span class="font-bold">{{
            selectedConsignation.dateConsignation | date : "dd/MM/yyyy"
          }}</span
          >.
        </p>
      </div>
      <div>
        <label for="numeroOrdre" class="block text-sm font-medium text-gray-700"
          >Numéro de l'Ordre de Recette associé</label
        >
        <input
          type="text"
          id="numeroOrdre"
          formControlName="numeroOrdre"
          placeholder="Ex: TP-2024-REG-301"
          class="w-full px-3 py-2 mt-1 text-gray-800 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#187181]"
        />
      </div>
      <!-- Modal Footer -->
      <div class="flex justify-end gap-4 pt-6 mt-2 border-t border-gray-200">
        <button
          type="button"
          (click)="closeModal()"
          class="px-6 py-2 font-semibold text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200"
        >
          Annuler
        </button>
        <button
          type="submit"
          [disabled]="regularisationForm.invalid"
          class="px-6 py-2 font-semibold text-white bg-[#187181] rounded-lg hover:opacity-90 disabled:opacity-50"
        >
          Valider la Régularisation
        </button>
      </div>
    </form>
  </div>
</div>
